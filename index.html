<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éœ¾éƒ½ç‹‚å¾’ - åºŸåœŸæ¡£æ¡ˆåº“</title>
    <style>
        :root {
            /* éœ¾éƒ½ç‹‚å¾’é£æ ¼è‰²æ¿ */
            --pf-æ·±çº¢: #8b3a3a; /* é“é”ˆçº¢ */
            --pf-å¤é‡‘: #cd7f32; /* è„é»„é“œ/é’é“œ */
            --pf-çº¸å¼ : #e0d8c8; /* æ³›é»„çš„å·¥ä¸šçº¸å¼  */
            --pf-è¾¹æ¡†: #2f2f2f; /* æªæ¢°é»‘é“ */
            --pf-æ–‡æœ¬: #1a1a1a; /* ç…¤çƒŸé»‘ */
            --pf-è­¦å‘Šçº¢: #ff4500; /* ç†”ç‚‰ç«å…‰æ©™ */
            --pf-é«˜äº®: #daa520;
        }

        /* === åŠ¨ç”»å®šä¹‰ === */
        @keyframes çº¸å¼ å±•å¼€ {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes å‘¼å¸å…‰ {
            0% { box-shadow: 0 0 50px rgba(0,0,0,0.9); }
            50% { box-shadow: 0 0 70px rgba(205, 127, 50, 0.15); } /* é»„é“œè‰²å‘¼å¸ */
            100% { box-shadow: 0 0 50px rgba(0,0,0,0.9); }
        }

        @keyframes å¼¹çª—è¿›å…¥ {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* ç´§æ€¥æœªä¿å­˜åŠ¨ç”» - è’¸æ±½å‹åŠ›è¿‡å¤§ */
        @keyframes ç´§æ€¥å‘¼å¸ {
            0% { transform: scale(1); box-shadow: 0 0 5px var(--pf-è­¦å‘Šçº¢); border-color: var(--pf-è­¦å‘Šçº¢); }
            50% { transform: scale(1.02); box-shadow: 0 0 20px var(--pf-è­¦å‘Šçº¢), inset 0 0 10px #ffcc00; }
            100% { transform: scale(1); box-shadow: 0 0 5px var(--pf-è­¦å‘Šçº¢); border-color: var(--pf-è­¦å‘Šçº¢); }
        }

        @keyframes èƒŒæ™¯æš—æµ {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ç«èŠ±é£æº…åŠ¨ç”» */
        @keyframes å°˜åŸƒæ¼‚æµ® {
            0% { transform: translateY(100vh) translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            80% { opacity: 0.8; }
            100% { transform: translateY(-10vh) translateX(40px) rotate(45deg); opacity: 0; }
        }

        body {
            background-color: #0a0a0a;
            /* çƒŸé›¾ä¸æ²¹æ±¡è´¨æ„Ÿ */
            background-image: 
                url('https://www.transparenttextures.com/patterns/black-scales.png'),
                radial-gradient(circle at 50% 50%, rgba(50, 30, 20, 0.4), rgba(0, 0, 0, 0.95));
            background-attachment: fixed, fixed;
            background-size: auto, 200% 200%;
            animation: èƒŒæ™¯æš—æµ 20s ease infinite;
            color: var(--pf-æ–‡æœ¬);
            font-family: "Source Han Serif SC", "Songti SC", "Courier New", serif; /* å¢åŠ ç­‰å®½å­—ä½“æ„Ÿ */
            margin: 0; padding: 30px 10px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        #ç‰¹æ•ˆå±‚ {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; pointer-events: none; overflow: hidden;
        }

        /* æ”¹ä¸ºç«èŠ±æ ·å¼ */
        .å¥¥æœ¯å°˜åŸƒ {
            position: absolute;
            background: #ffcc00;
            border-radius: 2px; /* æ–¹å½¢ç«èŠ± */
            box-shadow: 0 0 6px #ff4500;
        }

        .æ¡£æ¡ˆå®¹å™¨ {
            width: 100%; max-width: 1250px;
            background-color: var(--pf-çº¸å¼ );
            /* æ²¹æ¸ä¸çƒŸç†æ•ˆæœ */
            background-image: linear-gradient(to bottom, rgba(255,255,255,0.1), rgba(0,0,0,0.1)), url('https://www.transparenttextures.com/patterns/aged-paper.png');
            border: 8px solid var(--pf-è¾¹æ¡†);
            border-top: 15px solid var(--pf-è¾¹æ¡†); /* é¡¶éƒ¨åƒå‰ªè´´æ¿å¤¹å­ */
            padding: 30px;
            position: relative;
            animation: å‘¼å¸å…‰ 5s infinite ease-in-out, çº¸å¼ å±•å¼€ 0.8s ease-out;
            z-index: 1;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }

        header {
            text-align: center;
            border-bottom: 4px solid var(--pf-è¾¹æ¡†);
            margin-bottom: 25px; padding-bottom: 15px;
            transition: border-color 0.5s;
        }
        header:hover { border-bottom-color: var(--pf-æ·±çº¢); }

        h1 { 
            color: var(--pf-æ–‡æœ¬); font-size: 2.8em; margin: 0; letter-spacing: 0.1em; 
            text-transform: uppercase;
            text-shadow: 2px 2px 0px rgba(184, 134, 11, 0.3);
            font-family: "Impact", "Source Han Serif SC", serif; /* ç¡¬æœ—é£æ ¼ */
        }
        .å‰¯æ ‡é¢˜ { color: var(--pf-æ·±çº¢); font-size: 1.1em; font-weight: bold; margin-top: 5px; letter-spacing: 0.2em; text-transform: uppercase; }

        #çŠ¶æ€æ  { 
            font-size: 0.85em; color: var(--pf-è¾¹æ¡†); margin-bottom: 15px; 
            text-align: center; font-style: italic; height: 1.2em;
            transition: opacity 0.3s; font-family: "Courier New", monospace;
        }

        .æ§åˆ¶å° { 
            margin-bottom: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; 
            position: sticky; top: 0; z-index: 100; background: inherit; padding: 10px 0;
            backdrop-filter: blur(2px); align-items: center; border-bottom: 1px dashed var(--pf-å¤é‡‘);
        }

        .æŒ‰é’® {
            background: #3e2723; /* æ·±æ£•è‰²çš®é©æ„Ÿ */
            color: #d7ccc8; 
            border: 2px solid var(--pf-å¤é‡‘);
            padding: 8px 16px; cursor: pointer; font-weight: bold; 
            display: flex; align-items: center; gap: 5px;
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            font-family: "Courier New", sans-serif;
            text-transform: uppercase;
        }
        .æŒ‰é’®:hover { 
            background: var(--pf-å¤é‡‘); color: #000; 
            border-color: #000;
            transform: translateY(-2px); box-shadow: 0 5px 10px rgba(0,0,0,0.6);
        }
        .æŒ‰é’®:active { transform: translateY(0); box-shadow: 0 2px 3px rgba(0,0,0,0.3); }

        .åŒæ­¥æŒ‰é’® { background: #1b3320; border-color: #2e7d32; } /* ç±»ä¼¼åºŸåœŸæ¯’æ¶²ç»¿ */
        .åŒæ­¥æŒ‰é’®:hover { background: #2e7d32; color: white; }
        
        /* æœªä¿å­˜è­¦å‘Šæ ·å¼ - é”…ç‚‰è¿‡çƒ­ */
        .æŒ‰é’®-æœªä¿å­˜ {
            background: #8b0000 !important;
            border-color: var(--pf-è­¦å‘Šçº¢) !important;
            color: #fff !important;
            animation: ç´§æ€¥å‘¼å¸ 1s infinite ease-in-out !important;
        }
        
        .æŒ‰é’®-æ¨¡å¼ { background: #1a1a1a; border-color: #444; color: #888; }
        body.ç¼–è¾‘æ¨¡å¼ .æŒ‰é’®-æ¨¡å¼ { background: var(--pf-å¤é‡‘); border-color: #000; color: #000; }

        .åˆ†éš”ç¬¦ { width: 2px; height: 30px; background: var(--pf-è¾¹æ¡†); margin: 0 5px; opacity: 0.3; }

        .ç®¡ç†å‘˜ç»„ { display: none; gap: 10px; align-items: center; }
        body.ç¼–è¾‘æ¨¡å¼ .ç®¡ç†å‘˜ç»„ { display: flex; }

        .è¡¨æ ¼åŒ…è£…å±‚ { overflow-x: auto; border: 2px solid var(--pf-è¾¹æ¡†); box-shadow: inset 0 0 20px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; background-color: rgba(255,255,255,0.1); }
        
        thead { background-color: var(--pf-è¾¹æ¡†); color: var(--pf-å¤é‡‘); }
        th { padding: 12px; text-align: left; border: 1px solid #444; font-size: 0.9em; letter-spacing: 1px; }
        
        td { 
            padding: 10px; border: 1px solid #9e8c76; vertical-align: middle; font-size: 0.9em; 
            color: #2c241e;
            transition: background-color 0.3s;
        }

        tr:nth-child(even) { background-color: rgba(0,0,0,0.03); }
        tr:hover td { background-color: rgba(205, 127, 50, 0.1); }
        .è¡Œè¿›å…¥ { animation: çº¸å¼ å±•å¼€ 0.5s ease-out backwards; }

        .ç«‹ç»˜æ¡† { 
            width: 65px; height: 80px; 
            border: 2px solid var(--pf-è¾¹æ¡†); 
            outline: 1px solid var(--pf-å¤é‡‘);
            outline-offset: -4px;
            overflow: hidden; cursor: zoom-in; margin: 0 auto; 
            position: relative; background: #111;
            transition: transform 0.3s, box-shadow 0.3s;
            filter: sepia(0.2); /* å¾®å¾®çš„æ—§ç…§ç‰‡æ„Ÿ */
        }
        .ç«‹ç»˜æ¡†:hover { transform: scale(1.05); box-shadow: 0 4px 8px rgba(0,0,0,0.6); filter: sepia(0); z-index: 10; }
        .ç«‹ç»˜æ¡† img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
        .ç«‹ç»˜æ¡†:hover img { transform: scale(1.1); }
        
        .å§“åæ ¼ { font-weight: bold; color: #6d2416; font-family: "Impact", sans-serif; letter-spacing: 0.5px; }
        
        body.ç¼–è¾‘æ¨¡å¼ [contenteditable="true"]:hover { background: rgba(0,0,0,0.05); cursor: text; }
        body.ç¼–è¾‘æ¨¡å¼ [contenteditable="true"]:focus { 
            background: #fff; outline: none;
            box-shadow: 0 0 0 2px var(--pf-å¤é‡‘); color: #000;
        }

        .ç®¡ç†åˆ— { display: none; }
        body.ç¼–è¾‘æ¨¡å¼ .ç®¡ç†åˆ— { display: table-cell; }

        .ç®¡ç†æ ¼ { display: flex; flex-direction: column; gap: 5px; align-items: center; }
        .æ“ä½œç»„ { display: flex; gap: 5px; width: 100%; justify-content: center; }

        .æ’åºæ§ä»¶ { display: flex; gap: 3px; }
        .å°æ–¹é’® { 
            padding: 2px 6px; cursor: pointer; background: #5d4037; 
            color: white; border: 1px solid #3e2723; font-size: 10px; transition: 0.2s;
        }
        .å°æ–¹é’®:hover { background: var(--pf-å¤é‡‘); color: black; }

        .å¼¹çª—é®ç½© {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center;
            backdrop-filter: blur(3px); transition: opacity 0.3s;
        }

        .ä¸Šä¼ é¢æ¿ {
            background: var(--pf-çº¸å¼ ); border: 4px double var(--pf-è¾¹æ¡†);
            padding: 30px; width: 400px; text-align: center;
            box-shadow: 0 0 50px rgba(0,0,0,1);
            animation: å¼¹çª—è¿›å…¥ 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .ä¸Šä¼ é¢æ¿ h3 { color: var(--pf-è¾¹æ¡†); margin-top: 0; font-family: "Impact", sans-serif; }
        .ä¸Šä¼ åŒºåŸŸ {
            border: 2px dashed var(--pf-è¾¹æ¡†); padding: 20px; margin: 15px 0;
            color: var(--pf-è¾¹æ¡†); font-size: 0.9em; background: rgba(0,0,0,0.05);
            transition: background 0.3s;
        }
        .ä¸Šä¼ åŒºåŸŸ:hover { background: rgba(255,255,255,0.5); }

        .ç½‘å€è¾“å…¥ {
            width: 90%; padding: 8px; background: #f0f0f0; border: 1px solid #888;
            color: #333; margin-bottom: 10px; font-family: inherit; transition: box-shadow 0.3s;
        }
        .ç½‘å€è¾“å…¥:focus { box-shadow: 0 0 8px var(--pf-å¤é‡‘); outline: none; }

        #æ”¾å¤§é¢„è§ˆ { cursor: zoom-out; }
        #æ”¾å¤§é¢„è§ˆ img { 
            max-width: 85%; max-height: 85%; border: 4px solid var(--pf-å¤é‡‘); 
            box-shadow: 0 0 50px #000; animation: å¼¹çª—è¿›å…¥ 0.3s ease-out;
        }

        .ç‘Ÿå¸Œéš†ç¬¦å· { 
            text-align: center; margin-top: 30px; color: var(--pf-å¤é‡‘); 
            font-size: 1.5em; opacity: 0.6; letter-spacing: 15px; transition: opacity 0.5s;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .ç‘Ÿå¸Œéš†ç¬¦å·:hover { opacity: 1; text-shadow: 0 0 10px var(--pf-å¤é‡‘); transform: rotate(1deg); }
    </style>
</head>
<body>

    <div id="ç‰¹æ•ˆå±‚"></div>

    <div class="æ¡£æ¡ˆå®¹å™¨">
        <header>
            <h1>éœ¾éƒ½ç‹‚å¾’</h1>
            <div class="å‰¯æ ‡é¢˜">é˜¿è‚¯æ–¯å¡”é€šç¼‰è¦çŠ¯ä¸çº¿äºº</div>
        </header>

        <div id="çŠ¶æ€æ ">é½¿è½®è¿è½¬æ­£å¸¸ï¼Œæ³•åŠ›åºŸå¢Ÿè¯»æ•°ç¨³å®šã€‚</div>

        <div class="æ§åˆ¶å°">
            <!-- æ‰€æœ‰äººå¯è§ -->
            <button class="æŒ‰é’® æŒ‰é’®-æ¨¡å¼" onclick="åˆ‡æ¢æ¨¡å¼()" id="æ¨¡å¼æŒ‰é’®">âœ ç¼–è¾‘æ¨¡å¼</button>
            <button class="æŒ‰é’®" onclick="åŠ è½½æ•°æ®()">ğŸ”„ åˆ·æ–°æƒ…æŠ¥</button>
            <button class="æŒ‰é’®" style="background:#3e2723" onclick="å¯¼å‡ºå¤‡ä»½()">å¯¼å‡ºèƒ¶å·</button>

            <!-- ä»…ç¼–è¾‘æ¨¡å¼å¯è§ -->
            <div class="ç®¡ç†å‘˜ç»„">
                <div class="åˆ†éš”ç¬¦"></div>
                <button class="æŒ‰é’®" onclick="æ·»åŠ è¡Œ()">+ æ–°å¢æ¡£æ¡ˆ</button>
                <button class="æŒ‰é’® åŒæ­¥æŒ‰é’®" id="ä¿å­˜æŒ‰é’®" onclick="ä¿å­˜åˆ°äº‘ç«¯()">â— åˆ»å½•è‡³æœºæ¢ (åŒæ­¥)</button>
                <button class="æŒ‰é’®" style="background:#3e2723" onclick="è§¦å‘å¯¼å…¥()">å¯¼å…¥</button>
            </div>
            
            <input type="file" id="å¯¼å…¥æ¡†" style="display:none" accept=".json" onchange="å¯¼å…¥å¤‡ä»½(event)">
        </div>

        <div class="è¡¨æ ¼åŒ…è£…å±‚">
            <table>
                <thead>
                    <tr>
                        <th width="80">å½±åƒ</th>
                        <th width="150">ä»£å·/å§“å</th>
                        <th width="160">èº«ä»½/èŒä¸š</th>
                        <th width="200">åŠ¨æœº/æ‚¬èµ</th>
                        <th>æƒ…æŠ¥è®°å½•</th>
                        <th width="120" class="ç®¡ç†åˆ—">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="è¡¨æ ¼ä¸»ä½“"></tbody>
            </table>
        </div>
        <div id="é¡µå°¾é”šç‚¹"></div>
        <div class="ç‘Ÿå¸Œéš†ç¬¦å·">âš™ âš™ âš™ âš™ âš™</div>
    </div>

    <div id="æ”¾å¤§é¢„è§ˆ" class="å¼¹çª—é®ç½©" onclick="this.style.display='none'">
        <img id="é¢„è§ˆå›¾" src="">
    </div>

    <div id="æ›´å›¾å¼¹çª—" class="å¼¹çª—é®ç½©">
        <div class="ä¸Šä¼ é¢æ¿">
            <h3>æ›´æ–°é€šç¼‰ä»¤å½±åƒ</h3>
            <p style="font-size: 0.8em; color: #5d4037;">ç›´æ¥ç²˜è´´(Ctrl+V)ç…§ç‰‡<br>æˆ–ä½¿ç”¨ä¸‹æ–¹é€‰é¡¹</p>
            <div class="ä¸Šä¼ åŒºåŸŸ">
                <button class="æŒ‰é’®" style="font-size: 0.8em; margin: 0 auto;" onclick="document.getElementById('éšè—ä¸Šä¼ ').click()">é€‰æ‹©æœ¬åœ°èƒ¶å·</button>
            </div>
            <input type="text" id="ç½‘å€è¾“å…¥æ¡†" class="ç½‘å€è¾“å…¥" placeholder="æˆ–åœ¨æ­¤è¾“å…¥å½±åƒé“¾æ¥...">
            <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center;">
                <button class="æŒ‰é’®" onclick="ç¡®å®šç½‘å€()">ç¡®å®š</button>
                <button class="æŒ‰é’®" style="border-color:#555; background:#666;" onclick="å…³é—­æ›´å›¾å¼¹çª—()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <input type="file" id="éšè—ä¸Šä¼ " style="display:none" accept="image/*">

    <script>
        // === é…ç½®ä¿®æ”¹åŒºåŸŸ ===
        const BIN_ID = '69474b2143b1c97be9fbf27e';
        const API_KEY = '$2a$10$HCO6T/SodpbU9GwiCzOV2uvw75u5tfxjQ5vdK3rvhmJiWdFsUxqTu';
        const IMG_BB_KEY = '192ec7a9ecdec9b51ffed683da3842dc';
        const å¯†ç  = '781674';

        let å†…å­˜æ•°æ® = [];
        let å½“å‰ç¼–è¾‘ç´¢å¼• = -1;
        let æ˜¯å¦ç¼–è¾‘æ¨¡å¼ = false; 
        let æœ‰æœªä¿å­˜å˜æ›´ = false;

        window.onload = function() {
            åŠ è½½æ•°æ®();
            åˆå§‹åŒ–å¥¥æœ¯å°˜åŸƒ();
        };

        // --- æ ¸å¿ƒçŠ¶æ€æ§åˆ¶ ---

        function åˆ‡æ¢æ¨¡å¼() {
            if (!æ˜¯å¦ç¼–è¾‘æ¨¡å¼) {
                const p = prompt("è¯·è¾“å…¥å¤§å…¬å›½å¯†ä»¤ä»¥è§£é”æ¡£æ¡ˆ:");
                if (p === å¯†ç ) {
                    æ˜¯å¦ç¼–è¾‘æ¨¡å¼ = true;
                    document.body.classList.add('ç¼–è¾‘æ¨¡å¼');
                    document.getElementById('æ¨¡å¼æŒ‰é’®').innerHTML = "ğŸ‘ è§‚å¯Ÿæ¨¡å¼";
                    æ›´æ–°çŠ¶æ€("æƒé™éªŒè¯é€šè¿‡ã€‚");
                    æ¸²æŸ“è¡¨æ ¼();
                } else {
                    alert("å¯†ä»¤é”™è¯¯ï¼è­¦æŠ¥å·²è§¦å‘ã€‚");
                }
            } else {
                if (æœ‰æœªä¿å­˜å˜æ›´) {
                    if(!confirm("æƒ…æŠ¥å°šæœªåˆ»å½•ï¼Œé€€å‡ºå°†å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œç¡®å®šé€€å‡ºå—ï¼Ÿ")) return;
                }
                æ˜¯å¦ç¼–è¾‘æ¨¡å¼ = false;
                document.body.classList.remove('ç¼–è¾‘æ¨¡å¼');
                document.getElementById('æ¨¡å¼æŒ‰é’®').innerHTML = "âœ ç¼–è¾‘æ¨¡å¼";
                æ›´æ–°çŠ¶æ€("å›å½’è§‚å¯Ÿè€…è§†è§’ã€‚");
                æ¸²æŸ“è¡¨æ ¼();
            }
        }

        function è®¾ç½®æœªä¿å­˜çŠ¶æ€(çŠ¶æ€) {
            æœ‰æœªä¿å­˜å˜æ›´ = çŠ¶æ€;
            const btn = document.getElementById('ä¿å­˜æŒ‰é’®');
            if (çŠ¶æ€) {
                btn.classList.add('æŒ‰é’®-æœªä¿å­˜');
                btn.innerHTML = "âš  å˜æ›´æœªåˆ»å½•";
                document.title = "* æœªä¿å­˜ - éœ¾éƒ½ç‹‚å¾’æ¡£æ¡ˆ";
                saveLocal(); 
            } else {
                btn.classList.remove('æŒ‰é’®-æœªä¿å­˜');
                btn.innerHTML = "â— åˆ»å½•è‡³æœºæ¢ (åŒæ­¥)";
                document.title = "éœ¾éƒ½ç‹‚å¾’ - åºŸåœŸæ¡£æ¡ˆåº“";
            }
        }

        window.onbeforeunload = function(e) {
            if (æœ‰æœªä¿å­˜å˜æ›´) {
                e.preventDefault();
                e.returnValue = '';
                return 'ä¾¦æµ‹åˆ°æœªä¿å­˜çš„æ•°æ®æ³¢åŠ¨ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
            }
        };

        // --- æ•°æ®é€»è¾‘ ---

        async function åŠ è½½æ•°æ®() {
            æ›´æ–°çŠ¶æ€("æ­£åœ¨æ¥å…¥å‘æ¡æ•°æ®å¡”...");
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: { 'X-Master-Key': API_KEY, 'X-Bin-Meta': false }
                });
                const data = await res.json();
                å†…å­˜æ•°æ® = Array.isArray(data) ? data : (data.record || []);
                æ¸²æŸ“è¡¨æ ¼();
                è®¾ç½®æœªä¿å­˜çŠ¶æ€(false);
                æ›´æ–°çŠ¶æ€("æ¡£æ¡ˆå·²æ›´æ–°ã€‚æ„¿å¸ƒè±ighæŒ‡å¼•ä½ çš„å‘æ˜ã€‚");
            } catch (e) {
                æ›´æ–°çŠ¶æ€("è¿æ¥è¢«é™ç”µé£æš´é˜»æ–­ï¼Œè¯·æ£€æŸ¥ç½‘ç»œã€‚");
            }
        }

        function æ¸²æŸ“è¡¨æ ¼() {
            const tbody = document.getElementById("è¡¨æ ¼ä¸»ä½“");
            tbody.innerHTML = '';
            
            const editableAttr = æ˜¯å¦ç¼–è¾‘æ¨¡å¼ ? 'contenteditable="true"' : '';

            å†…å­˜æ•°æ®.forEach((npc, index) => {
                const tr = document.createElement('tr');
                tr.className = 'è¡Œè¿›å…¥';
                tr.style.animationDelay = `${index * 0.05}s`;
                
                let html = `
                    <td>
                        <div class="ç«‹ç»˜æ¡†" onclick="é¢„è§ˆå›¾ç‰‡('${npc.ç«‹ç»˜}')">
                            <img src="${npc.ç«‹ç»˜}" class="äººç‰©å›¾">
                        </div>
                    </td>
                    <td ${editableAttr} onblur="åŒæ­¥å†…å­˜(${index}, 'å§“å', this.innerText)" class="å§“åæ ¼">${npc.å§“å}</td>
                    <td ${editableAttr} onblur="åŒæ­¥å†…å­˜(${index}, 'èŒä½', this.innerText)">${npc.èŒä½}</td>
                    <td ${editableAttr} onblur="åŒæ­¥å†…å­˜(${index}, 'åŠ¨æœº', this.innerText)">${npc.åŠ¨æœº}</td>
                    <td ${editableAttr} onblur="åŒæ­¥å†…å­˜(${index}, 'å¤‡æ³¨', this.innerText)">${npc.å¤‡æ³¨}</td>
                `;

                html += `
                    <td class="ç®¡ç†åˆ—">
                        <div class="ç®¡ç†æ ¼">
                            <div class="æ’åºæ§ä»¶">
                                <button class="å°æ–¹é’®" onclick="ç§»åŠ¨ä½æ¬¡(${index}, -1)">â–²</button>
                                <button class="å°æ–¹é’®" onclick="ç§»åŠ¨ä½æ¬¡(${index}, 1)">â–¼</button>
                            </div>
                            <div class="æ“ä½œç»„">
                                <button class="æŒ‰é’®" style="padding:2px 6px; font-size:11px; flex:1;" onclick="æ‰“å¼€æ›´å›¾å¼¹çª—(${index})">æ›´å›¾</button>
                                <button class="æŒ‰é’®" style="padding:2px 6px; font-size:11px; background:#444; flex:1;" onclick="åˆ é™¤NPC(${index})">æŠ¹é™¤</button>
                            </div>
                        </div>
                    </td>
                `;

                tr.innerHTML = html;
                tbody.appendChild(tr);
            });
        }

        function åŒæ­¥å†…å­˜(idx, key, val) {
            const cleanVal = val.trim();
            if (å†…å­˜æ•°æ®[idx][key] !== cleanVal) {
                å†…å­˜æ•°æ®[idx][key] = cleanVal;
                è®¾ç½®æœªä¿å­˜çŠ¶æ€(true);
            }
        }

        function æ·»åŠ è¡Œ() {
            å†…å­˜æ•°æ®.push({ 
                ç«‹ç»˜: 'https://via.placeholder.com/65x80/2f2f2f/cd7f32?text=?', 
                å§“å: 'æœªçŸ¥ç›®æ ‡', èŒä½: 'ä¸æ˜', åŠ¨æœº: 'å¾…æŸ¥', å¤‡æ³¨: 'è¾“å…¥æƒ…æŠ¥...' 
            });
            æ¸²æŸ“è¡¨æ ¼();
            è®¾ç½®æœªä¿å­˜çŠ¶æ€(true);
            setTimeout(() => document.getElementById('é¡µå°¾é”šç‚¹').scrollIntoView({ behavior: 'smooth' }), 100);
        }

        // ä¿®æ”¹ï¼šå¢åŠ å¯†ç éªŒè¯
        function åˆ é™¤NPC(idx) {
            // ç¬¬ä¸€æ­¥ï¼šé˜²æ­¢è¯¯è§¦
            if (!confirm(`ç¡®å®šè¦ä»æ¡£æ¡ˆä¸­æ°¸ä¹…æŠ¹é™¤ã€Œ${å†…å­˜æ•°æ®[idx].å§“å}ã€å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`)) return;

            // ç¬¬äºŒæ­¥ï¼šå¯†ç éªŒè¯
            const p = prompt("è¯·è¾“å…¥å¤§å…¬å›½å¯†ä»¤ä»¥ç¡®è®¤é”€æ¯æ¡£æ¡ˆ:");
            if (p === å¯†ç ) {
                å†…å­˜æ•°æ®.splice(idx, 1);
                æ¸²æŸ“è¡¨æ ¼();
                è®¾ç½®æœªä¿å­˜çŠ¶æ€(true);
                æ›´æ–°çŠ¶æ€("æ¡£æ¡ˆå·²é”€æ¯ã€‚");
            } else {
                alert("å¯†ä»¤é”™è¯¯ï¼æ“ä½œå·²å–æ¶ˆã€‚");
            }
        }

        function ç§»åŠ¨ä½æ¬¡(index, step) {
            const newIndex = index + step;
            if (newIndex >= 0 && newIndex < å†…å­˜æ•°æ®.length) {
                const temp = å†…å­˜æ•°æ®[index];
                å†…å­˜æ•°æ®[index] = å†…å­˜æ•°æ®[newIndex];
                å†…å­˜æ•°æ®[newIndex] = temp;
                æ¸²æŸ“è¡¨æ ¼();
                è®¾ç½®æœªä¿å­˜çŠ¶æ€(true);
            }
        }

        async function ä¿å­˜åˆ°äº‘ç«¯() {
            const p = prompt("ç¡®è®¤è¦åˆ»å½•æ•°æ®å—ï¼Ÿ(è¾“å…¥å¯†ä»¤):");
            if (p !== å¯†ç ) { alert("å¯†ä»¤é”™è¯¯ã€‚"); return; }

            æ›´æ–°çŠ¶æ€("æ­£åœ¨å‘æœºæ¢ä¸Šä¼ å·ç­’...");
            try {
                await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY },
                    body: JSON.stringify(å†…å­˜æ•°æ®)
                });
                è®¾ç½®æœªä¿å­˜çŠ¶æ€(false);
                æ›´æ–°çŠ¶æ€("åˆ»å½•æˆåŠŸï¼æ¡£æ¡ˆå·²å®‰å…¨å­˜å‚¨ã€‚");
            } catch (e) {
                æ›´æ–°çŠ¶æ€("ä¸Šä¼ å¤±è´¥ã€‚");
                alert("äº‘ç«¯åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœºæ¢è¿æ¥ã€‚");
            }
        }

        // --- å›¾ç‰‡å¤„ç† ---

        function æ‰“å¼€æ›´å›¾å¼¹çª—(index) {
            å½“å‰ç¼–è¾‘ç´¢å¼• = index;
            document.getElementById('æ›´å›¾å¼¹çª—').style.display = 'flex';
            document.getElementById('ç½‘å€è¾“å…¥æ¡†').value = '';
        }

        function å…³é—­æ›´å›¾å¼¹çª—() {
            document.getElementById('æ›´å›¾å¼¹çª—').style.display = 'none';
        }

        async function æ‰§è¡Œä¸Šä¼ (file) {
            if (!file) return;
            æ›´æ–°çŠ¶æ€("æ­£åœ¨æ˜¾å½±ç…§ç‰‡...");
            å…³é—­æ›´å›¾å¼¹çª—();
            const formData = new FormData();
            formData.append("image", file);
            try {
                const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMG_BB_KEY}`, {
                    method: "POST", body: formData
                });
                const result = await res.json();
                if (result.success) {
                    å†…å­˜æ•°æ®[å½“å‰ç¼–è¾‘ç´¢å¼•].ç«‹ç»˜ = result.data.url;
                    æ¸²æŸ“è¡¨æ ¼();
                    è®¾ç½®æœªä¿å­˜çŠ¶æ€(true);
                    æ›´æ–°çŠ¶æ€("å½±åƒæ›´æ›¿æˆåŠŸã€‚");
                }
            } catch (err) { alert("æ˜¾å½±å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¯æ°´(ç½‘ç»œ)ã€‚"); }
        }

        function ç¡®å®šç½‘å€() {
            const url = document.getElementById('ç½‘å€è¾“å…¥æ¡†').value.trim();
            if (url) {
                å†…å­˜æ•°æ®[å½“å‰ç¼–è¾‘ç´¢å¼•].ç«‹ç»˜ = url;
                æ¸²æŸ“è¡¨æ ¼();
                è®¾ç½®æœªä¿å­˜çŠ¶æ€(true);
                å…³é—­æ›´å›¾å¼¹çª—();
                æ›´æ–°çŠ¶æ€("å·²é“¾æ¥å¤–éƒ¨å½±åƒã€‚");
            }
        }

        document.getElementById('éšè—ä¸Šä¼ ').onchange = (e) => {
            æ‰§è¡Œä¸Šä¼ (e.target.files[0]);
        };

        // --- æ‚é¡¹ä¸ç‰¹æ•ˆ ---

        function åˆå§‹åŒ–å¥¥æœ¯å°˜åŸƒ() {
            const å®¹å™¨ = document.getElementById('ç‰¹æ•ˆå±‚');
            // å‡å°‘ç²’å­æ•°é‡ï¼Œæ¨¡æ‹Ÿç«èŠ±
            for (let i = 0; i < 25; i++) {
                åˆ›å»ºç²’å­(å®¹å™¨);
            }
        }

        function åˆ›å»ºç²’å­(å®¹å™¨) {
            const ç²’å­ = document.createElement('div');
            ç²’å­.classList.add('å¥¥æœ¯å°˜åŸƒ');
            const size = Math.random() * 4 + 1; // ç«èŠ±ç¨å¤§ä¸€ç‚¹
            ç²’å­.style.width = `${size}px`; ç²’å­.style.height = `${size}px`;
            ç²’å­.style.left = `${Math.random() * 100}%`;
            const duration = Math.random() * 5 + 3; // é€Ÿåº¦æ›´å¿«
            const delay = Math.random() * 5;
            ç²’å­.style.animation = `å°˜åŸƒæ¼‚æµ® ${duration}s linear ${delay}s infinite`;
            å®¹å™¨.appendChild(ç²’å­);
        }

        document.addEventListener('paste', function(e) {
            if (document.getElementById('æ›´å›¾å¼¹çª—').style.display === 'flex') {
                const items = (e.clipboardData || e.originalEvent.clipboardData).items;
                for (let item of items) {
                    if (item.type.indexOf("image") !== -1) {
                        æ‰§è¡Œä¸Šä¼ (item.getAsFile());
                    }
                }
            }
            if (e.target.getAttribute('contenteditable')) {
                e.preventDefault();
                const text = (e.originalEvent || e).clipboardData.getData('text/plain');
                document.execCommand('insertText', false, text);
            }
        });

        function saveLocal() {
            localStorage.setItem('pf_rotr_local', JSON.stringify(å†…å­˜æ•°æ®));
        }

        function å¯¼å‡ºå¤‡ä»½() {
            const blob = new Blob([JSON.stringify(å†…å­˜æ•°æ®, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `éœ¾éƒ½æ¡£æ¡ˆå¤‡ä»½_${new Date().toLocaleDateString()}.json`;
            a.click();
        }

        function è§¦å‘å¯¼å…¥() { document.getElementById("å¯¼å…¥æ¡†").click(); }

        function å¯¼å…¥å¤‡ä»½(e) {
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                å†…å­˜æ•°æ® = JSON.parse(ev.target.result);
                æ¸²æŸ“è¡¨æ ¼();
                è®¾ç½®æœªä¿å­˜çŠ¶æ€(true);
                æ›´æ–°çŠ¶æ€("æ—§æ—¥æ¡£æ¡ˆå·²è½½å…¥ï¼Œç‚¹å‡»åˆ»å½•ç”Ÿæ•ˆã€‚");
            };
            reader.readAsText(file);
        }

        function é¢„è§ˆå›¾ç‰‡(s) {
            document.getElementById("é¢„è§ˆå›¾").src = s;
            document.getElementById("æ”¾å¤§é¢„è§ˆ").style.display = 'flex';
        }

        function æ›´æ–°çŠ¶æ€(s) { 
            const el = document.getElementById("çŠ¶æ€æ ");
            el.style.opacity = 0;
            setTimeout(() => { el.innerText = s; el.style.opacity = 1; }, 200);
        }
    </script>
</body>
</html>
